<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h2>ðŸ¤– NUMI - Your Math ChatBOT</h2>
        <div id="chatbox"></div>

        <div class="input-area">
            <input type="text" id="userInput" placeholder="Type your math question...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const chatbox = document.getElementById("chatbox");
        const startupMsg = "ðŸ¤– (HI, AM YOUR MATH BUDDY!)";
        chatbox.innerHTML += `<p><b>Bot:</b> ${startupMsg}</p>`;

        const input = document.getElementById("userInput");
        input.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                e.preventDefault();
                sendMessage();
            }
        });
    });

    async function sendMessage() {
        const input = document.getElementById("userInput");
        const chatbox = document.getElementById("chatbox");
        const userInput = input.value.trim();

        if (!userInput) return;

        chatbox.innerHTML += `<p><b>You:</b> ${userInput}</p>`;
        chatbox.scrollTop = chatbox.scrollHeight;

        input.value = "";

        try {
            const response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: userInput })
            });

            if (!response.ok) {
                throw new Error("Server error " + response.status);
            }

            const data = await response.json();

            if (data.image) {
                chatbox.innerHTML += `<p><b>Bot:</b> ${data.reply}</p>`;
                chatbox.innerHTML += `<img src="data:image/png;base64,${data.image}" style="max-width:400px;display:block;margin:10px 0;">`;
            } else {
                chatbox.innerHTML += `<p><b>Bot:</b> ${data.reply}</p>`;
            }
        } catch (err) {
            chatbox.innerHTML += `<p style="color:red"><b>Bot:</b> Error - ${err.message}</p>`;
        }

        chatbox.scrollTop = chatbox.scrollHeight;
    }
    </script>
</body>
</html>
